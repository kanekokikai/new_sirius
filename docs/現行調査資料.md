# 現行調査資料（As-Is）

対象: `new_sirius`（レンタル会社 基幹システム **プロトタイプ**）  
作成日: 2025-12-26  
根拠: リポジトリ内コード（React + Vite / モックデータ）  

> 注意: 本資料は「**現状の実装（As-Is）**」を棚卸ししたものです。  
> DB/API/永続化は未実装（モック）であり、実運用要件を確定する資料ではありません。

---

## 1. システム概要

- **アプリ種別**: フロントエンドのみ（React + Vite + TypeScript）
- **目的**: 画面遷移と権限制御、一覧/検索/登録（ダミー）画面のUI確認
- **認証**: モック認証（LocalStorageにユーザー保存）
- **部署切替**: ログインユーザーが所属する部署の範囲で切替可能

### 1.1 起動/開発（参考）
- `npm install`
- `npm run dev`（READMEに `http://localhost:5173` と記載）

---

## 2. 部署一覧（マスター）

部署は `src/types.ts` と `src/data/mockData.ts` で定義される。

- フロント
- 営業
- 経理
- ドライバー
- 工場
- AK
- マスター管理

---

## 3. 認証/権限（部署 × 機能）

### 3.1 認証方式（現状）
- 画面: **ログイン**（`/`）
- ログイン成功で `/home` へ遷移
- 未入力（ユーザーID/パスワード共に空）で **ゲストログイン**（全部署・全権限）
- ログイン状態は `localStorage["authUser"]` に保存

### 3.2 権限制御（現状）
- ルート単位の制御: `ProtectedRoute`（未ログインは `/` へリダイレクト）
- 機能単位の制御: 部署の許可機能 `permissions[department]` に `featureKey` が含まれるか

### 3.3 権限マップ（部署 → 機能キー）

| 部署 | 利用可能機能（FeatureKey） |
|---|---|
| フロント | inventory / machine / orders / dispatch / sites / data |
| 営業 | inventory / orders / sites / ar / dispatch / data |
| 経理 | ar / invoices / adjustment / machine |
| ドライバー | dispatch |
| 工場 | dispatch / inventory / repair |
| AK | orders / data / dispatch |
| マスター管理 | masters |

> 詳細: `src/data/mockData.ts` の `departmentAccess`

---

## 4. 機能一覧（カード）

機能カードは `src/data/mockData.ts` の `featureCards`。

| 機能キー | 機能名 | 概要 | サブ機能（表示文言） |
|---|---|---|---|
| inventory | 在庫確認 | 在庫一覧・検索・稼働状況の確認 | 在庫一覧 / 検索 / 利用可能 / 貸出中 / 修理中 |
| machine | 機械管理 | 機械台帳の閲覧（参照のみ） | 機械台帳 / 検索 / 詳細閲覧 |
| orders | 受注管理 | 搬入 / 引き取り / 移動の受注管理 | 搬入（新規・検索・編集）/ 引き取り（新規・検索・編集）/ 移動（新規・検索・編集） |
| dispatch | 配車 | 指示書・行動予定の管理と出力 | 搬入機械指示書 / 移動機械指示書 / 引取機械指示書 / トラック行動予定（カレンダー / 一覧 / 出力） |
| sites | 現場管理 | 現場登録・検索・詳細編集 | 現場一覧 / 新規登録 / 検索 / 詳細・編集 |
| data | データ管理 | データ出力 / レポート / CSV・Excel | エクスポート / レポート / CSV / Excel |
| ar | 売掛台帳 | 売掛一覧・検索・未収金表示 | 売掛一覧 / 検索 / フィルター / 未収金表示 / 詳細 |
| invoices | 請求書発行 | 請求書一覧と発行・出力 | 請求書一覧 / 新規発行 / 検索 / PDF出力 |
| adjustment | 金額訂正 | 訂正入力と履歴管理 | 訂正対象検索 / 訂正入力 / 訂正履歴表示 |
| repair | 修理管理 | 修理関連のタブ管理 | 見積作成（新規・一覧）/ 社内修理（一覧・登録）/ アラート管理 / 貴社機械（一覧・詳細） |
| masters | マスター管理 | 顧客・機械・社員マスター | 顧客マスター（一覧・登録・検索・詳細）/ 機械マスター（一覧・登録・検索・詳細）/ 社員マスター（一覧・登録・検索・詳細） |

---

## 5. 画面一覧（ルーティング）

ルーティングは `src/App.tsx` で定義。

| 画面ID | 画面名 | パス | 認証 | 備考 |
|---|---|---|---|---|
| S-001 | ログイン | `/` | 不要 | モック認証 / 未入力でゲストログイン |
| S-002 | ホーム | `/home` | 必須 | 部署切替 + 機能カード表示 |
| S-003 | 機能プレースホルダー | `/feature/:featureKey` | 必須 | 検索条件/一覧（サンプル）/受注作成モーダル（ダミー） |
| S-004 | 配車指示書（詳細） | `/feature/dispatch/:instructionKey` | 必須 | instructionKey: inbound/pickup/transfer/truckPlan |
| S-999 | フォールバック | `*` | - | ログインへ |

---

## 6. 画面項目定義（検索/入力/表示）

> 本プロトタイプは DB を持たず、一覧は `src/data/featureContent.ts` / `src/data/dispatchInstructions.ts` のサンプル表を表示します。  
> 以下は **画面に存在する入力/検索UIと、表示テーブルの列**を定義として整理したものです。

### 6.1 S-001 ログイン（`/`）

#### 入力項目
| 項目 | 種別 | 備考 |
|---|---|---|
| ユーザーID | テキスト | 未入力OK（未入力+パスワード未入力でゲストログイン） |
| パスワード | パスワード | 未入力OK（同上） |

#### メッセージ
- エラー: 「ユーザーIDまたはパスワードが違います」

---

### 6.2 S-002 ホーム（`/home`）

#### 表示/操作
- 部署切替（ボタン群）
- 機能カード一覧（権限に応じて表示）
- ログアウト（ユーザー情報破棄）

---

### 6.3 S-003 機能プレースホルダー（`/feature/:featureKey`）

共通: URLクエリ `dept` により「対象部署」を切替（例: `?dept=フロント`）。  
権限: 対象部署の権限に `featureKey` が含まれない場合「権限がありません」。

#### 6.3.1 inventory（在庫確認）

**検索（フィルター）**
| 項目 | 種別 | 備考 |
|---|---|---|
| 種類 | テキスト | 例) 建機 |
| 種別 | テキスト | 例) 油圧ショベル |
| 機械No. | テキスト | 例) M-1001 |
| 状況（出庫中 / 修理中 / 予約） | テキスト | ガント表の日付セル（列4以降）も対象 |
| クリア | ボタン | フィルター初期化 |

**表示テーブル（サンプル）**
- 表: 「在庫ガントチャート（サンプル）」
- 列: `種類, 種別, 機械No., 1/10..1/17`
- セル状態: 出庫中=青 / 修理中=赤 / 予約=黄

#### 6.3.2 machine（機械管理）

**検索（フィルター）**
| 項目 | 種別 | 備考 |
|---|---|---|
| 種類ID | テキスト | 例) 建機 |
| 種別ID | テキスト | 例) 油圧ショベル |
| 商品No. | テキスト | 例) M-1001 |
| 購入日 | テキスト | 例) 2024 / 2024-04 / 2024-04-01（部分一致 + 数字一致） |
| 売却日 | テキスト | 同上 |
| 区分 | テキスト | 例) 自社 / リース / 売却 |
| クリア | ボタン | フィルター初期化 |

**表示テーブル（サンプル）**
- 表: 「機械台帳（サンプル）」
- 列（抜粋・全24列）: 種類ID / 種別ID / 商品No. / 品名1..3 / 区分 / 会社 / 型式 / 仕様 / 製造NO / 資産コード / 製造年月 / 購入日 / メーカー / 購入先 / 購入額（税込/税抜） / 売却日 / 売却先 / 売却額（税込/税抜） / 備考

#### 6.3.3 orders（受注管理）

**操作（作成）**
- 「搬入受注作成」「引取受注作成」「移動受注作成」ボタン → **受注作成モーダル（デモ）**  
  - 保存は未実装（ボタン disabled）

**検索（一覧モーダル表示用の条件）**
- 種類（複数選択可）: 搬入 / 引取 / 移動（トグルボタン）
- 期間（開始）: date
- 期間（終了）: date
- 種別: テキスト
- 得意先名: テキスト
- 現場: テキスト
- 検索: ボタン（押下で「受注検索結果」モーダル表示）
- クリア: ボタン（条件初期化）

**表示テーブル（サンプル）**
- 表: 「受注一覧（搬入/引取/移動）」
- 列: 受注ID / 種類 / 種別 / 得意先名 / 機械 / 現場 / 予定日 / 状態

##### 受注作成（デモ）入力項目一覧
| 項目 | フィールド（コード上） | 種別 | 備考 |
|---|---|---|---|
| 搬入日 | inboundDate | date | - |
| 搬入時間（From） | inboundTimeFrom | time | - |
| 搬入時間（To） | inboundTimeTo | time | - |
| 受注者 | orderTaker | テキスト | - |
| 回送区分 | transportDivision | select | 回送 / 自社 / 外注 / 未選択 |
| 拠点 | transportBase | select | 本社 / 支店 / ヤード / 未選択 |
| 得意先 | customer | テキスト | - |
| 受注種類 | orderCreateType | 表示のみ | 搬入/引取/移動 |
| 現場 | siteName | テキスト | - |
| 住所 | siteAddress | テキスト | - |
| 工事名 | constructionName | テキスト | - |
| 車輛（複数） | vehicles | checkbox | ダンプ/2t/3t/4t/7t/ショート/10t/大型/指定車 |
| レッカー | wrecker | select | 無 / 有 / ユニック |
| 引取予定日 | pickupPlannedDate | date | - |
| 使用日数 | useDays | テキスト（数値想定） | inputMode numeric |
| 発注者 | orderer | テキスト | - |
| 現場連絡先 | siteContact | テキスト | - |
| 回送費：車輛サイズ | transportFeeVehicleSize | select | 車輛候補と同一 |
| 回送費：住所 | transportFeeAddress | テキスト | - |
| 回送費：金額 | transportFeeAmount | テキスト（数値想定） | inputMode numeric |
| フロント備考 | noteFront | textarea | - |
| 工場備考 | noteFactory | textarea | - |
| ドライバー備考 | noteDriver | textarea | - |

#### 6.3.4 dispatch（配車メニュー）
- 配車メニューは `featureKey=dispatch` のプレースホルダーにボタンを表示し、詳細画面へ遷移する。
- ボタン:
  - 搬入指示書 / 引取指示書 / 移動指示書 / トラック予定指示書

#### 6.3.5 sites（現場管理）

**検索（フィルター）**
| 項目 | 種別 |
|---|---|
| 期間（開始） | date |
| 期間（終了） | date |
| 得意先 | テキスト |
| 現場 | テキスト |
| 最終搬入日（開始） | date |
| 最終搬入日（終了） | date |
| 最終受注日（開始） | date |
| 最終受注日（終了） | date |
| クリア | ボタン |

**表示テーブル（サンプル）**
- 表: 「現場一覧（サンプル）」
- 列: 現場ID / 名称 / 顧客 / 住所 / 期間 / 最終搬入日 / 最終受注日

#### 6.3.6 data（データ管理）
**表示テーブル（サンプル）**
- 表: 「データ管理（サンプル）」
- 列: 分類 / 形式 / 最終出力 / 備考

#### 6.3.7 ar（売掛台帳）
**表示テーブル（サンプル）**
- 表: 「売掛台帳（サンプル）」
- 列: 請求先 / 請求額 / 請求日 / 入金状況

#### 6.3.8 invoices（請求書発行）
**表示テーブル（サンプル）**
- 表: 「請求書一覧（サンプル）」
- 列: 請求書ID / 顧客 / 金額 / 発行日 / 状態

#### 6.3.9 adjustment（金額訂正）
**表示テーブル（サンプル）**
- 表: 「金額訂正履歴（サンプル）」
- 列: 対象 / 訂正前 / 訂正後 / 理由 / 実行者 / 日時

#### 6.3.10 repair（修理管理）
**表示テーブル（サンプル）**
- 表: 「修理管理（サンプル）」
- 列: 種別 / 機械 / 金額/内容 / 状態 / 更新日

#### 6.3.11 masters（マスター管理）
**表示テーブル（サンプル）**
- 表: 「マスター管理（サンプル）」
- 列: 区分 / ID / 名称 / 備考

---

### 6.4 S-004 配車指示書（`/feature/dispatch/:instructionKey`）

共通:
- `instructionKey` が不正: 「指示書が見つかりません」
- 対象部署で `dispatch` 権限がない: 「権限がありません」

#### inbound（搬入指示書）
**検索（フィルター）**
| 項目 | 種別 |
|---|---|
| 期間（開始） | date |
| 期間（終了） | date |
| 得意先 | テキスト |
| 検索 | ボタン（現状は表示のみ） |
| クリア | ボタン |

**表示テーブル（サンプル）**
- 表: 「搬入指示一覧（サンプル）」
- 列: 搬入日 / 時間 / 指示ID / 機械名（数量） / 車両 / 所属 / 得意先 / 現場 / 住所 / 備考 / 担当 / 状態
- 操作: 「編集」ボタン → 編集モーダル（保存未実装）

#### pickup（引取指示書）
- 列: 指示ID / 得意先 / 現場 / 機械 / 引取日 / トラック / 担当 / 状態

#### transfer（移動指示書）
- 列: 指示ID / 移動元 / 移動先 / 機械 / 移動日 / トラック / 担当 / 状態

#### truckPlan（トラック予定指示書）
- 列: 日付 / トラック / 区間 / 用途 / 担当

---

## 7. データ/項目定義（現状の実装範囲）

### 7.1 DB定義
- **DB/マイグレーション/ORMは存在しない**（本リポジトリはUIプロトタイプ）

### 7.2 モックデータ定義
- 部署・権限・ユーザー: `src/data/mockData.ts`
- 各機能の一覧データ: `src/data/featureContent.ts`
- 配車指示書データ: `src/data/dispatchInstructions.ts`

---

## 付録（CSV）

同梱ファイル:
- `docs/現行調査資料/機能一覧.csv`
- `docs/現行調査資料/画面一覧.csv`
- `docs/現行調査資料/部署別権限.csv`
- `docs/現行調査資料/項目定義_受注作成（デモ）.csv`
- `docs/現行調査資料/項目定義_検索条件.csv`



